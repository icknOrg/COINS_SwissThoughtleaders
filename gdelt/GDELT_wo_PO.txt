#legacySQL
SELECT c.Source Source, c.Target Target, Count RawCount, "Undirected" Type, RATIO_TO_REPORT(Count) OVER () Weight FROM (
SELECT a.name Source, b.name Target, COUNT(*) as Count
FROM (FLATTEN(
SELECT GKGRECORDID, UNIQUE(REGEXP_REPLACE(SPLIT(V2Persons,';'), r',.*', '')) name
FROM [gdelt-bq:gdeltv2.gkg] 
WHERE DATE>20210101000000 and DATE < 20210505000000 and TranslationInfo like '%srclc:deu%' and not(V2Persons like '%Jens Spahn%' or V2Persons like '%Peter Hook%' or V2Persons like '%%Remo Ankli' or V2Persons like '%Angel Castle%' or V2Persons like '%Aleksandr Lukaschenko%' or V2Persons like '%Jeff Bezos%' or V2Persons like '%Franco Matt%' or V2Persons like '%Barack Obama%' or V2Persons like '%Adolf Dietrich%' or V2Persons like '%Carolyn Kaster%' or V2Persons like '%Sargans Erland%' or V2Persons like '%Alex Brandon%' or V2Persons like '%Bruno Damann%' or V2Persons like '%Thurgau Svp%' or V2Persons like '%Fabian Molina%' or V2Persons like 'Obama Biden' or V2Persons like '%Mattea Meyer%' or V2Persons like '%Simonetta Sommaruga%' or V2Persons like '%Leyen Ursula%' or V2Persons like '%Andrew Harnik%' or V2Persons like '%Simon Moser%' or V2Persons like '%Olma-Hall John%' or V2Persons like '%Jesper Olofsson%' or V2Persons like '%Dustin Jeffrey%' or V2Persons like '%Gerhard Pfister%' or V2Persons like '%Philipp Wolfaktualisiert%' or V2Persons like '%Thomas Aeschi%' or V2Persons like '5William Shakespeare5' or V2Persons like '%Thomas Scheitlin%' or V2Persons like '%Keanu Reeves%' or V2Persons like '%Mathias Gabathuler%' or V2Persons like '%louis vierne%' or V2Persons like '%Julie Maxwell%' or V2Persons like '%Markus Buschor%' or V2Persons like '%Pope Francis%' or V2Persons like '%Scl Tiger%' or V2Persons like 'Spono Eagles' or V2Persons like '%Sinojapanese Nomura%' or V2Persons like '%Finanzkonglomerats Greensill%' or V2Persons like '%Catholic Konfessionsteils%' or V2Persons like 'States Europe' or V2Persons like '%Sino Pharm%' or V2Persons like '%Horacio Rodriguez%' or V2Persons like '%katja suding%' or V2Persons like '%Stammtisch Winterthur%' or V2Persons like '%Norbert Walter Borjans%'or V2Persons like '%Baden-Wrttemberg Landkreis Schwabisch Hall%' or V2Persons like '&Canton Vaud&' or V2Persons like '%Canton Geneva%' or V2Persons like 'Canton Lucerne' or V2Persons like '%Pierre Maudet%' or V2Persons like '%Canton Schaffhausen%' or V2Persons like '%Gerhard Bereswill%' or V2Persons like '%S Braunschweig Brinkmann%' or V2Persons like '%Angela Merkel%' or V2Persons like '%Karl Lauterbach%' or V2Persons like '%Olaf Scholz%' or V2Persons like '%Boris Johnson%' or V2Persons like '%Peter Altmaier%' or V2Persons like '%Michael Kretschmer%' or V2Persons like '%Klaus Holetscheck%'or V2Persons like '%Franziska Giffey%' or V2Persons like '%Bodo Ramelow%' or V2Persons like '%Banjamin Netanyahu%' or V2Persons like '%Alain Berset%' or V2Persons like '%Christian Lindner%' or V2Persons like '%Heiko Maas%' or V2Persons like '%Jair Bolsonaro%' or V2Persons like '%Catherine Fegebank%' or V2Persons like '%Malu Dreyer%' or V2Persons like '%Mario Draghi%' or V2Persons like '%Gernot Marx%' or V2Persons like '%Melanie Brinkmann%' or V2Persons like '%Tedros Adhanom Ghebreyesus%' or V2Persons like '%Christian Drosten%') 
,name)) a
JOIN EACH (
SELECT GKGRECORDID, UNIQUE(REGEXP_REPLACE(SPLIT(V2Persons,';'), r',.*', '')) name
FROM [gdelt-bq:gdeltv2.gkg] 
WHERE DATE>20210101000000 and DATE < 20210505000000 and V2Locations like '%Switzerland%Switzerland%' and TranslationInfo like '%srclc:deu%' 
) b
ON a.GKGRECORDID=b.GKGRECORDID
WHERE a.name<b.name
GROUP EACH BY 1,2
ORDER BY 3 DESC
LIMIT 500
) c
order by Count DESC